(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66eb16d9"],{"1d76":function(t,e,n){},"3c79":function(t,e,n){t.exports=n.p+"img/default-cover.6b0534ab.png"},"880d":function(t,e,n){"use strict";var a=n("1d76"),r=n.n(a);r.a},beb6:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"md-detail",attrs:{flex:""}},[n("div",{staticClass:"operate",attrs:{flex:""}},[n("div",{staticClass:"back",attrs:{flex:""},on:{click:function(e){return t.$router.push({name:"backend.md"})}}},[n("svg-icon",{attrs:{name:"back"}}),n("span",[t._v("返回")])],1),n("a",{attrs:{flex:""},on:{click:function(e){t.showGuide=!0}}},[n("svg-icon",{attrs:{name:"info"}}),t._v(" markdown语法指南 ")],1),n("loading-button",{attrs:{loading:t.saving,text:"上传",icon:"save"},nativeOn:{click:function(e){return t.save(e)}}})],1),n("div",{staticClass:"head",attrs:{flex:""}},[n("float-input",{attrs:{name:"标题",size:1.3,value:t.getInfo()?t.getInfo().name:""},on:{input:t.inputTitle}}),n("float-input",{staticClass:"summary",attrs:{name:"简介",size:1,value:t.getInfo()?t.getInfo().summary:""},on:{input:t.inputSummary}})],1),n("div",{staticClass:"info",attrs:{flex:""}},[n("div",{staticClass:"cover"},[n("img",{attrs:{src:t.getInfo()?t.getInfo().cover:t.defaultCover}}),n("label",[n("span",[t._v("封面链接:")]),n("input",{domProps:{value:t.getInfo()?t.getInfo().cover:""},on:{focusout:t.changeCover}})])]),n("div",{staticClass:"tags-time",attrs:{flex:""}},[n("div",{staticClass:"tags",attrs:{flex:""}},[n("span",{staticClass:"tag-icon"},[n("svg-icon",{attrs:{name:"tag"}})],1),t._l(t.getInfo()?t.getInfo().tags:[],(function(e,a){return n("div",{key:e,class:{editing:t.tagEditIndex===a}},[n("input",{attrs:{disabled:t.tagEditIndex!==a,"data-old":e,"data-idx":a},domProps:{value:e},on:{focusout:t.editTag}}),n("div",{attrs:{flex:""}},[n("span",{attrs:{title:"删除"},on:{click:function(e){return t.clickTrash(a)}}},[n("svg-icon",{attrs:{name:"trash"}})],1),n("span",{attrs:{"data-idx":a,title:"编辑"},on:{click:t.clickEdit}},[n("svg-icon",{attrs:{name:"edit"}})],1)])])})),n("span",{staticClass:"add",attrs:{title:"添加标签"},on:{click:t.addTag}},[n("svg-icon",{attrs:{name:"add"}})],1)],2),n("div",{staticClass:"time",attrs:{flex:""}},[n("span",[n("span",[t._v("创建:")]),t._v(t._s(t.parseTime(t.getInfo()?t.getInfo().createTime:0)))]),n("span",[n("span",[t._v("修改:")]),t._v(t._s(t.parseTime(t.getInfo()?t.getInfo().modifyTime:0)))])])])]),n("div",{ref:"text",staticClass:"text",attrs:{flex:""}},[n("div",{staticClass:"markdown",style:{width:t.mdWidth},attrs:{flex:""}},[n("div",{ref:"textarea",staticClass:"textarea"})]),n("resizer",{attrs:{orient:"h"},on:{start:t.startResize,resize:t.doResize}}),n("div",{staticClass:"html",attrs:{flex:""}},[n("span",{staticClass:"--markdown",domProps:{innerHTML:t._s(t.htmlText)}})])],1),n("markdown-help",{directives:[{name:"show",rawName:"v-show",value:t.showGuide,expression:"showGuide"}],nativeOn:{click:function(e){if(e.target!==e.currentTarget)return null;t.showGuide=!1}}})],1)},r=[],i=(n("b4fb"),n("ea69"),n("053b"),n("e18c"),n("1c2e"),n("6a61"),n("cf7f")),s=n("52ef"),o=n("e793"),c=n("56d7"),u=n("025e"),d=n("9f3a"),f=n("44b8"),l=n("8e8da"),m=n("3c79"),g=n.n(m),v=n("9c46"),h=n.n(v),p=(n("65c0"),n("3fca"),n("c588"),n("547e"),n("58a6"),n("3259")),x=n("b33a"),b={name:"MdDetail",components:{MarkdownHelp:x["a"],Resizer:p["a"],LoadingButton:l["a"],FloatInput:f["a"]},data:function(){return{defaultCover:g.a,showGuide:!1,tagEditIndex:-1,mdText:"",codeMirror:null,mdWidth:"40%",resizeStart:{pos:!1,size:!1},saving:!1,newInfo:{name:"编辑标题",file:"",cover:"",createTime:"",modifyTime:"",summary:"编辑简介",tags:[]}}},computed:Object(o["a"])(Object(o["a"])({},Object(d["b"])(["gitUtil","config"])),{},{id:function(){return this.$route.params.id},info:function(){var t,e=Object(s["a"])(this.config.md);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n.file===this.id)return n}}catch(a){e.e(a)}finally{e.f()}},htmlText:function(){return Object(u["e"])(this.mdText)}}),mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:case"end":return e.stop()}}),e)})))()},watch:{$route:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:case"end":return e.stop()}}),e)})))()}},methods:{init:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.mdText="","backend.md.detail"!==t.$route.name){e.next=6;break}if(document.title="后台-文章-"+t.id,"new"===t.$route.params.id){e.next=6;break}return e.next=6,t.getMdText();case 6:t.codeMirror||(t.codeMirror=new h.a(t.$refs.textarea,{indentUnit:2,tabSize:2,theme:"dracula",lineNumbers:!0,line:!0,mode:"markdown"}),t.codeMirror.on("change",(function(){t.mdText=t.codeMirror.getValue()})),t.codeMirror.setValue(t.mdText));case 7:case"end":return e.stop()}}),e)})))()},getMdText:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["b"])("".concat(c["staticFolder"],"/md/").concat(t.id,"/index.md"));case 2:n=e.sent,n[0]?t.mdText=n[1]:t.$message.error(Object(u["d"])(n[1]));case 4:case"end":return e.stop()}}),e)})))()},getInfo:function(){return"new"===this.id?this.newInfo:this.info},parseTime:function(t){return Object(u["f"])(t,!0)},inputTitle:function(t){var e=this.getInfo();e.name=t[1]},inputSummary:function(t){var e=this.getInfo();e.summary=t[1]},changeCover:function(t){var e=this.getInfo();e.cover=t.target.value},clickTrash:function(t){var e=this.getInfo();e.tags.splice(t,1)},clickEdit:function(t){var e=t.currentTarget;this.tagEditIndex=parseInt(e.getAttribute("data-idx")),this.$nextTick((function(){e.parentElement.previousElementSibling.focus()}))},editTag:function(t){var e=this.getInfo(),n=t.target;this.tagEditIndex=-1;var a,r=Object(s["a"])(e.tags);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(i!==n.getAttribute("data-old")&&i===n.value)return this.$message.warning("标签不能重复!")}}catch(o){r.e(o)}finally{r.f()}e.tags.splice(parseInt(n.getAttribute("data-idx")),1,n.value)},addTag:function(){var t=this.getInfo();t.tags.push("输入标签"+t.tags.length)},startResize:function(t){this.resizeStart={pos:t,size:this.$refs.text.querySelector(".markdown").scrollWidth}},doResize:function(t){var e=this.$refs.text.scrollWidth,n=this.resizeStart.size+(t-this.resizeStart.pos);n>e/5&&n<4*e/5&&(this.mdWidth="".concat(n,"px"))},save:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.saving){e.next=2;break}return e.abrupt("return");case 2:if(!t.gitUtil){e.next=24;break}if(n=t.getInfo(),n.name&&n.summary&&n.tags.length&&n.cover){e.next=6;break}return e.abrupt("return",t.$message.warning("标题,简介,标签和封面均不能为空!"));case 6:return t.saving=!0,a=(new Date).getTime(),n.modifyTime=a,"new"!==t.id?a=t.id:(n.file=a.toString(),n.createTime=a,r=t.config.md,r.push(JSON.parse(JSON.stringify(n)))),e.next=12,t.gitUtil.updateConfig(t.config);case 12:if(i=e.sent,!i[0]){e.next=20;break}return e.next=16,t.gitUtil.updateMd({folder:a,md:t.mdText,html:t.htmlText});case 16:s=e.sent,s[0]?(t.$message.success("上传成功!"),t.$router.push({name:"backend.md"})):t.$message.error(Object(u["d"])(s[1])),e.next=21;break;case 20:t.$message.error(Object(u["d"])(i[1]));case 21:t.saving=!1,e.next=26;break;case 24:t.$message.warning("请先登录!"),t.$emit("login");case 26:case"end":return e.stop()}}),e)})))()}}},w=b,k=(n("880d"),n("9ca4")),T=Object(k["a"])(w,a,r,!1,null,"9448e2fa",null);e["default"]=T.exports}}]);
//# sourceMappingURL=chunk-66eb16d9.f1471818.js.map